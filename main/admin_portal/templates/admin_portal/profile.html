{% extends "admin_portal/base.html" %}
{% block content %}

<div id="confirmationModal" class="hidden fixed z-10 inset-0 overflow-y-auto">
    <div class="flex items-center justify-center min-h-screen">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <div id="confirmationMessage" class="text-gray-700 mb-4"></div>
            <div class="flex justify-end">
                <button id="confirmBtn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mr-2">Confirm</button>
                <button id="cancelBtn" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">Cancel</button>
            </div>
        </div>
    </div>
</div>

<a href="{% url 'admin_portal:list' %}">back to student list</a>

<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-8">Student Profile</h1>
    <div class="bg-white rounded-lg shadow-md p-6">
        <form action="{% url 'admin_portal:update_profile'%}" method="post">
            {% csrf_token %} 
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2" for="roll_number">Roll Number:</label>
                <input readonly class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" name="roll_number" type="text" value="{{ student_details.roll_number }}">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2" for="name">Name:</label>
                <input readonly class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" name="name" type="text" value="{{ student_details.name }}">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2" for="course">Course:</label>
                <input readonly class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" name="course" type="text" value="{{ student_details.course }}">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2" for="category">Category:</label>
                <input readonly class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" name="category" type="text" value="{{ student_details.category }}">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2" for="department">Department:</label>
                <input readonly class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" name="department" type="text" value="{{ student_details.department }}">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2" for="tuition_fee">Tuition Fee:</label>
                <input type = "number" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" name="tuition_fee" type="text" value="{{ student_details.tuition_fee }}">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2" for="insurance_fee">Insurance Fee:</label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" name="insurance_fee" type="text" value="{{ student_details.insurance_fee }}">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2" for="examination_fee">Examination Fee:</label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" name="examination_fee" type="text" value="{{ student_details.examination_fee }}">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2" for="registration_fee">Registration Fee:</label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" name="registration_fee" type="text" value="{{ student_details.registration_fee }}">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2" for="gymkhana_fee">Gymkhana Fee:</label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" name="gymkhana_fee" type="text" value="{{ student_details.gymkhana_fee }}">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2" for="medical_fee">Medical Fee:</label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" name="medical_fee" type="text" value="{{ student_details.medical_fee }}">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2" for="student_benevolent_fund">Student Benevolent Fund:</label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" name="student_benevolent_fund" type="text" value="{{ student_details.student_benevolent_fund }}">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2" for="lab_fee">Lab Fee:</label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" name="lab_fee" type="text" value="{{ student_details.lab_fee }}">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2" for="semester_mess_advance">Semester Mess Advance:</label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" name="semester_mess_advance" type="text" value="{{ student_details.semester_mess_advance }}">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2" for="one_time_fee">One-time Fee:</label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" name="one_time_fee" type="text" value="{{ student_details.one_time_fee }}">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2" for="refundable_security_deposit">Refundable Security Deposit:</label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" name="refundable_security_deposit" type="text" value="{{ student_details.refundable_security_deposit }}">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2" for="accommodation_charges">Accommodation Charges:</label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" name="accommodation_charges" type="text" value="{{ student_details.accommodation_charges }}">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2" for="student_welfare_fund">Student Welfare Fund:</label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" name="student_welfare_fund" type="text" value="{{ student_details.student_welfare_fund }}">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2" for="mess_rebate">Mess Rebate:</label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" name="mess_rebate" type="text" value="{{ student_details.mess_rebate }}">
            </div>
            <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                Update
            </button>
        </form>
    </div>
</div>

<script>
    window.onload = function() {
    const form = document.querySelector('form');
    const inputFields = form.querySelectorAll('input[type="text"], input[type="number"]');
    const confirmationModal = document.getElementById('confirmationModal');
    const confirmationMessage = document.getElementById('confirmationMessage');
    const confirmBtn = document.getElementById('confirmBtn');
    const cancelBtn = document.getElementById('cancelBtn');

    form.addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent the form from submitting

        // Get the changed values
        const changedValues = Array.from(inputFields)
            .filter(input => input.value !== input.defaultValue)
            .map(input => `${input.name}: ${input.defaultValue} -> ${input.value}`)
            .join('\n');

        // Show the confirmation modal
        const message = changedValues
            ? `The following changes will be made:\n\n${changedValues}\n\nDo you want to proceed?`
            : 'No changes have been made.';

        confirmationMessage.textContent = message;
        confirmationModal.classList.remove('hidden');

        confirmBtn.onclick = () => {
            form.submit(); // Submit the form
            confirmationModal.classList.add('hidden');
        }

        cancelBtn.onclick = () => {
            confirmationModal.classList.add('hidden');
        }
    });
}
</script>

<style>
    #confirmationModal {
    backdrop-filter: blur(5px);
}

#confirmationModal .bg-white {
    max-width: 500px;
}
</style>

{% endblock %}
